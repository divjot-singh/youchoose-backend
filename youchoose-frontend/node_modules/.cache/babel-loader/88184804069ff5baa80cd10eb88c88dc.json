{"ast":null,"code":"import { getAuth, GoogleAuthProvider, signInWithPopup, signOut, createUserWithEmailAndPassword, signInWithEmailAndPassword, signInWithCustomToken } from \"firebase/auth\";\nimport { initializeApp } from \"firebase/app\";\nimport { getAnalytics } from \"firebase/analytics\";\nimport { UserType } from '../entities/user';\nimport { LocalStorageKeys } from '../utils/localstorageKeys';\nimport LocalStorageMethods from './localstorageService';\nconst firebaseConfig = {\n  apiKey: process.env.REACT_APP_FIREBASE_API_KEY,\n  authDomain: process.env.REACT_APP_FIREBASE_AUTH_DOMAIN,\n  projectId: process.env.REACT_APP_FIREBASE_PROJECT_ID,\n  storageBucket: process.env.REACT_APP_FIREBASE_STORAGE_BUCKET,\n  messagingSenderId: process.env.REACT_APP_FIREBASE_MESSAGING_SENDER_ID,\n  appId: process.env.REACT_APP_FIREBASE_API_ID,\n  measurementId: process.env.REACT_APP_FIREBASE_MEASUREMENT_ID\n};\nexport const InitialiseFirebaseApp = () => {\n  const app = initializeApp(firebaseConfig);\n  const analytics = getAnalytics(app);\n  return true;\n};\n_c = InitialiseFirebaseApp;\n\nconst getUser = (firebaseUser, userType, token) => {\n  const user = {\n    display_name: firebaseUser.displayName || '',\n    email: firebaseUser.email || '',\n    photo_url: firebaseUser.photoURL || '',\n    uid: firebaseUser.uid,\n    user_type: userType,\n    token: token\n  };\n  return user;\n};\n\nexport const SaveUserToLocalStorage = user => {\n  LocalStorageMethods.set(LocalStorageKeys.user_id, user.uid);\n  LocalStorageMethods.set(LocalStorageKeys.token, user.token);\n  LocalStorageMethods.set(LocalStorageKeys.type, user.user_type);\n};\n_c2 = SaveUserToLocalStorage;\nexport const RemoveUserFromLocalStorage = () => {\n  LocalStorageMethods.delete(LocalStorageKeys.user_id);\n  LocalStorageMethods.delete(LocalStorageKeys.token);\n  LocalStorageMethods.delete(LocalStorageKeys.type);\n};\n_c3 = RemoveUserFromLocalStorage;\nexport const getError = err => {\n  const error = {\n    code: err.code,\n    message: err.message\n  };\n  console.error(err);\n  return error;\n};\nexport const GetCurrentUser = async () => {\n  try {\n    var _LocalStorageMethods$;\n\n    const auth = getAuth();\n    const token = (_LocalStorageMethods$ = LocalStorageMethods.get(LocalStorageKeys.token)) !== null && _LocalStorageMethods$ !== void 0 ? _LocalStorageMethods$ : '';\n\n    if (token) {\n      var _LocalStorageMethods$2;\n\n      const result = await signInWithCustomToken(auth, (_LocalStorageMethods$2 = LocalStorageMethods.get(LocalStorageKeys.token)) !== null && _LocalStorageMethods$2 !== void 0 ? _LocalStorageMethods$2 : '');\n\n      if (result) {\n        const user = getUser(result.user, UserType.MODERATOR, token || '');\n        SaveUserToLocalStorage(user);\n        return user;\n      }\n\n      return null;\n    }\n\n    return null;\n  } catch (err) {\n    return getError(err);\n  }\n};\n_c4 = GetCurrentUser;\nexport const SignUpWithGoogle = async () => {\n  const auth = getAuth();\n  const provider = new GoogleAuthProvider();\n\n  try {\n    const result = await signInWithPopup(auth, provider);\n\n    if (result) {\n      const idToken = await createCustomToken(result.user);\n      const user = getUser(result.user, UserType.MODERATOR, idToken.token || '');\n      SaveUserToLocalStorage(user);\n      return user;\n    }\n\n    return null;\n  } catch (err) {\n    return getError(err);\n  }\n};\n_c5 = SignUpWithGoogle;\nexport const Register = async (email, password, username) => {\n  if (!email || !password) return null;\n  const auth = getAuth();\n\n  try {\n    const result = await createUserWithEmailAndPassword(auth, email, password);\n\n    if (result) {\n      const idToken = await createCustomToken(result.user);\n      const user = getUser(result.user, UserType.MODERATOR, idToken.token || '');\n      SaveUserToLocalStorage(user);\n      return user;\n    }\n\n    return null;\n  } catch (err) {\n    return getError(err);\n  }\n};\n_c6 = Register;\nexport const LoginWithEmail = async (email, password) => {\n  if (!email || !password) return null;\n  const auth = getAuth();\n\n  try {\n    const result = await signInWithEmailAndPassword(auth, email, password);\n\n    if (result) {\n      const idToken = await createCustomToken(result.user);\n      const user = getUser(result.user, UserType.MODERATOR, idToken.token || '');\n      SaveUserToLocalStorage(user);\n      return user;\n    }\n\n    return null;\n  } catch (err) {\n    return getError(err);\n  }\n};\n_c7 = LoginWithEmail;\nexport const Logout = async () => {\n  const auth = getAuth();\n  await signOut(auth);\n  RemoveUserFromLocalStorage();\n};\n_c8 = Logout;\n\nfunction createCustomToken(user) {\n  throw new Error('Function not implemented.');\n}\n\nvar _c, _c2, _c3, _c4, _c5, _c6, _c7, _c8;\n\n$RefreshReg$(_c, \"InitialiseFirebaseApp\");\n$RefreshReg$(_c2, \"SaveUserToLocalStorage\");\n$RefreshReg$(_c3, \"RemoveUserFromLocalStorage\");\n$RefreshReg$(_c4, \"GetCurrentUser\");\n$RefreshReg$(_c5, \"SignUpWithGoogle\");\n$RefreshReg$(_c6, \"Register\");\n$RefreshReg$(_c7, \"LoginWithEmail\");\n$RefreshReg$(_c8, \"Logout\");","map":{"version":3,"names":["getAuth","GoogleAuthProvider","signInWithPopup","signOut","createUserWithEmailAndPassword","signInWithEmailAndPassword","signInWithCustomToken","initializeApp","getAnalytics","UserType","LocalStorageKeys","LocalStorageMethods","firebaseConfig","apiKey","process","env","REACT_APP_FIREBASE_API_KEY","authDomain","REACT_APP_FIREBASE_AUTH_DOMAIN","projectId","REACT_APP_FIREBASE_PROJECT_ID","storageBucket","REACT_APP_FIREBASE_STORAGE_BUCKET","messagingSenderId","REACT_APP_FIREBASE_MESSAGING_SENDER_ID","appId","REACT_APP_FIREBASE_API_ID","measurementId","REACT_APP_FIREBASE_MEASUREMENT_ID","InitialiseFirebaseApp","app","analytics","getUser","firebaseUser","userType","token","user","display_name","displayName","email","photo_url","photoURL","uid","user_type","SaveUserToLocalStorage","set","user_id","type","RemoveUserFromLocalStorage","delete","getError","err","error","code","message","console","GetCurrentUser","auth","get","result","MODERATOR","SignUpWithGoogle","provider","idToken","createCustomToken","Register","password","username","LoginWithEmail","Logout","Error"],"sources":["/Users/divjotsingh/Documents/Youchoose/youchoose/src/services/firebaseService.tsx"],"sourcesContent":["import React from 'react'\nimport { Auth, getAuth, getRedirectResult, GoogleAuthProvider, OAuthCredential, signInWithPopup, signInWithCredential, UserCredential, User as FirebaseUser, signOut, EmailAuthProvider, createUserWithEmailAndPassword, EmailAuthCredential, signInWithEmailAndPassword, getIdTokenResult, IdTokenResult, signInWithCustomToken } from \"firebase/auth\";\nimport { FirebaseError, initializeApp } from \"firebase/app\";\nimport { getAnalytics } from \"firebase/analytics\";\nimport User, { UserType } from '../entities/user';\nimport { LocalStorageKeys } from '../utils/localstorageKeys';\nimport LocalStorageMethods from './localstorageService';\nimport { useCommonComponents } from '../providers/commonComponentsProvider';\nimport { ErrorCodeStrings } from '../utils/errorCodeStrings';\nimport {Error as AppError} from '../entities/error';\nconst firebaseConfig = {\n  apiKey: process.env.REACT_APP_FIREBASE_API_KEY,\n  authDomain: process.env.REACT_APP_FIREBASE_AUTH_DOMAIN,\n  projectId: process.env.REACT_APP_FIREBASE_PROJECT_ID,\n  storageBucket: process.env.REACT_APP_FIREBASE_STORAGE_BUCKET,\n  messagingSenderId: process.env.REACT_APP_FIREBASE_MESSAGING_SENDER_ID,\n  appId: process.env.REACT_APP_FIREBASE_API_ID,\n  measurementId: process.env.REACT_APP_FIREBASE_MEASUREMENT_ID\n};\n\nexport const InitialiseFirebaseApp = () => {\n    const app = initializeApp(firebaseConfig);\n    const analytics = getAnalytics(app);\n    return true\n}\n\nconst getUser = (firebaseUser:FirebaseUser, userType:UserType, token:string):User => {\n    const user:User = {\n        display_name: firebaseUser.displayName || '',\n        email: firebaseUser.email || '',\n        photo_url: firebaseUser.photoURL || '',\n        uid: firebaseUser.uid,\n        user_type: userType,\n        token: token\n    } \n\n    return user;\n}\n\nexport const SaveUserToLocalStorage = (user:User) => {\n    LocalStorageMethods.set(LocalStorageKeys.user_id, user.uid)\n    LocalStorageMethods.set(LocalStorageKeys.token, user.token)\n    LocalStorageMethods.set(LocalStorageKeys.type, user.user_type)\n}\n\nexport const RemoveUserFromLocalStorage = () => {\n    LocalStorageMethods.delete(LocalStorageKeys.user_id)\n    LocalStorageMethods.delete(LocalStorageKeys.token)\n    LocalStorageMethods.delete(LocalStorageKeys.type)\n}\n\nexport const getError = (err:FirebaseError | any) => {\n    const error:Error = {\n        code: err.code,\n        message: err.message\n    }\n    console.error(err)\n    return error\n}\n\nexport const GetCurrentUser = async (): Promise<User | null | Error> => {\n    try{\n        const auth : Auth = getAuth();\n        const token:string= LocalStorageMethods.get(LocalStorageKeys.token) ?? ''\n        \n        if(token){\n            const result: UserCredential | null = await signInWithCustomToken(auth, LocalStorageMethods.get(LocalStorageKeys.token) ?? '')\n            if(result){\n                const user = getUser(result.user, UserType.MODERATOR, token || '');\n                SaveUserToLocalStorage(user);\n                return user;\n            }\n            return null;\n        }\n        return null\n    } catch(err) {\n        return getError(err);\n    } \n}\n\nexport const SignUpWithGoogle = async (): Promise<User | null | Error> => {\n        const auth : Auth = getAuth();\n        const provider:GoogleAuthProvider = new GoogleAuthProvider();\n        try{\n            const result: UserCredential | null = await signInWithPopup(auth, provider)\n            if(result){\n                const idToken:IdTokenResult = await createCustomToken(result.user)\n                const user = getUser(result.user, UserType.MODERATOR, idToken.token || '');\n                SaveUserToLocalStorage(user);\n                return user;\n            }\n            return null;\n        } catch(err){\n            return getError(err);\n        }\n}\n\nexport const Register = async (email?:string, password?:string, username?:string):Promise<User | null | Error> =>{\n    if(!email || !password) return null\n    const auth : Auth = getAuth();\n    \n    try{\n        const result: UserCredential | null = await createUserWithEmailAndPassword(auth, email, password)\n        if(result){\n            const idToken:IdTokenResult = await createCustomToken(result.user)\n            const user = getUser(result.user, UserType.MODERATOR, idToken.token || '');\n            SaveUserToLocalStorage(user);\n            return user;\n        }\n        return null\n    } catch(err:FirebaseError | any){\n        return getError(err);\n    }\n}\n\nexport const LoginWithEmail = async (email?:string, password?:string): Promise<User | null | Error> => {\n    if(!email || !password) return null\n    const auth : Auth = getAuth();\n    \n    try{\n        const result: UserCredential | null = await signInWithEmailAndPassword(auth, email, password)\n        if(result){\n            const idToken:IdTokenResult = await createCustomToken(result.user)\n            const user = getUser(result.user, UserType.MODERATOR, idToken.token || '');\n            SaveUserToLocalStorage(user);\n            return user;\n        }\n        return null\n    } catch(err:FirebaseError | any){\n        return getError(err);\n    }\n}\n\nexport const Logout = async () => {\n    const auth : Auth = getAuth();\n    await signOut(auth)\n    RemoveUserFromLocalStorage()\n}\n\nfunction createCustomToken(user: FirebaseUser): IdTokenResult | PromiseLike<IdTokenResult> {\n    throw new Error('Function not implemented.');\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}